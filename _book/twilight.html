<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Light-level geolocation analysis</title>
  <meta name="description" content="How to analyze light-level geolocator tracking data for studies of birds.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Light-level geolocation analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="Images/front.png" />
  <meta property="og:description" content="How to analyze light-level geolocator tracking data for studies of birds." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Light-level geolocation analysis" />
  
  <meta name="twitter:description" content="How to analyze light-level geolocator tracking data for studies of birds." />
  <meta name="twitter:image" content="Images/front.png" />

<meta name="author" content="Simeon Lisovski, Martins Briedis, Kiran Danjahl-Adams, Lykke Pedersen, Sarah Davidson, …, Michael T. Hallworth, Michael Sumner, Simon Wotherspoon, Eli Bridge (201X) The Nuts and Bolts of Light-Level Geolocation Analyses. Journal X:xxx-xxx. DOI:00000.00">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="loadingData.html">
<link rel="next" href="GeoLight.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Light-level geolocation analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="sturcture-of-the-manual.html"><a href="sturcture-of-the-manual.html"><i class="fa fa-check"></i>Sturcture of the manual</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="start.html"><a href="start.html"><i class="fa fa-check"></i><b>1</b> Getting started</a></li>
<li class="chapter" data-level="2" data-path="datasets.html"><a href="datasets.html"><i class="fa fa-check"></i><b>2</b> The Datasets</a></li>
<li class="chapter" data-level="3" data-path="loadingData.html"><a href="loadingData.html"><i class="fa fa-check"></i><b>3</b> Loading data into R</a></li>
<li class="chapter" data-level="4" data-path="twilight.html"><a href="twilight.html"><i class="fa fa-check"></i><b>4</b> Twilight Annotation</a></li>
<li class="chapter" data-level="5" data-path="GeoLight.html"><a href="GeoLight.html"><i class="fa fa-check"></i><b>5</b> GeoLight</a></li>
<li class="chapter" data-level="6" data-path="probGLS.html"><a href="probGLS.html"><i class="fa fa-check"></i><b>6</b> probGLS</a></li>
<li class="chapter" data-level="7" data-path="SGAT.html"><a href="SGAT.html"><i class="fa fa-check"></i><b>7</b> SGAT</a></li>
<li class="chapter" data-level="8" data-path="FLightR.html"><a href="FLightR.html"><i class="fa fa-check"></i><b>8</b> FLightR</a></li>
<li class="chapter" data-level="9" data-path="presentation.html"><a href="presentation.html"><i class="fa fa-check"></i><b>9</b> Presentation of results</a></li>
<li class="chapter" data-level="10" data-path="movebank.html"><a href="movebank.html"><i class="fa fa-check"></i><b>10</b> Movemebank</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Light-level geolocation analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="twilight" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Twilight Annotation</h1>
<p>There are a few options for how to define / edit twilights.</p>
<p>All three of the analysis packages described here (GeoLight, SGAT, and FLightR) require as one of their inputs a dataframe containing the times of sunrise and sunset (henceforth twilights) for the duration of the study period. The twilight times are estimated based on a light-level threshold, which is the light value that seperates day from night - values above the threshold indicate the sun has risen and values below the threshold value indicate the sun has set. There are a few options for how to generate the twilight data. <code>twilightCalc</code> is one function that allows transitions to be defined and is part of the <code>GeoLight</code> package. Another function that is easier to use and more interactive (and thus preffered) is called <code>preprocessLight</code> from the <code>TwGeos</code>package. Both require a threshold value be specified to define the transition events.</p>
<hr />
<blockquote>
<p>How do I know which thresold to use?</p>
<p>You should choose the lowest value that is consistently above any noise in the nighttime light levels. For many .lig data sets 2.5 is above any nighttime noise. For forest interior, ground dwelling species a lower threshold may be helpful - especially if there isn’t much ‘noise’ during the night. A threshold of 1 may be appropriate for such species.</p>
</blockquote>
<p>It is usually a good idea to plot (parts) the data and see how the threshold fits into the light recordings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">threshold &lt;-<span class="st"> </span><span class="fl">2.5</span>

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>) )
<span class="kw">with</span>(raw[<span class="dv">2000</span><span class="op">:</span><span class="dv">5000</span>,], <span class="kw">plot</span>(Date, Light, <span class="dt">type =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>))
<span class="kw">abline</span>(<span class="dt">h=</span>threshold, <span class="dt">col=</span><span class="st">&quot;orange&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="Light-level_geolocation_analysis_files/figure-html/unnamed-chunk-6-1.svg" width="960" /></p>
<p>Another useful plot can be created using <code>lightImage</code>; In the resulting figure, each day is represented by a thin horizontal line that plots the light values as grayscale pixels (dark = low light and white = maximum light) in order from bottom to top. a light image allows you to visualize an entire data set at once, and easily spot discrepancies in light to dark transitions. If you define <code>addDeploymentLine = TRUE</code> the sunrise and sunset lines for the calibration site are added to the plot. This allows you to see when the birds were likely at the deployment site.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">offset &lt;-<span class="st"> </span><span class="dv">12</span> <span class="co"># adjusts the y-axis to put night (dark shades) in the middle</span>

<span class="kw">lightImage</span>( <span class="dt">tagdata =</span> raw, <span class="co"># light data</span>
<span class="dt">offset =</span> offset,     
<span class="dt">zlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="co"># y axis</span></code></pre></div>
<p><img src="Light-level_geolocation_analysis_files/figure-html/unnamed-chunk-7-1.svg" width="960" /></p>
<p>In the next step, we want to define daily sunrise and sunset times. <code>preprocessLight</code> is an interactive function for editing light data and deriving these twilight times Note: if you are working on a Mac you must install Quartz first (<a href="https://www.xquartz.org" class="uri">https://www.xquartz.org</a>) and then set gr.Device to “x11” in the function. If you are working with a virtual machine, the function may not work at all. Detailed instructions of how to complete the interactive process can be found by running the following code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?preprocessLight</code></pre></div>
<p>Below, we explain the major functionalities.</p>
<p>When you run,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">twl &lt;-<span class="st"> </span><span class="kw">preprocessLight</span>(raw, 
<span class="dt">threshold =</span> threshold,
<span class="dt">offset =</span> offset, 
<span class="dt">lmax =</span> <span class="dv">20</span>, <span class="co"># light range</span>
<span class="dt">gr.Device =</span> <span class="st">&quot;x11&quot;</span>) <span class="co"># x11 works on a mac (if Quarz has been installed and works on most Windows machines too)</span></code></pre></div>
<p>two windows will appear. Move them so they are not on top of each other and you can see both. They should look like a big black blob (Kiran`s expression). This identifies the “nightime” period over time. The top of the blob shows all the sunrises and the bottom of blob shows all the sunsets. You can note for instance that the days get longer at the beggining of the time series, because the blob gets wider.</p>
<p>Step 1. Click on the window entitled “select subset” with the left mouse button to choose start and right mouse button to choose end. You will notice that the red bar at the top moves and that the second window zooms into that time period. Select when you want your time series to start and end. This allows you to ignore for instance periods of nesting. Once you are happy with the start and end of the timeseries press “a” on the keyboard to accept and move to next step.</p>
<p><img src="Images/step1.png" width = 650/></p>
<p>Step 2. click on the window entitled “Find twilights” and the second window will zoom in. All you need to do here is click in the dark part of the image and this will identify all the sunrises (orange) and sunsets (blue) based on the threshold defined in the presvious section. Press “a” on the keyboard to accept and move to next step.</p>
<p><img src="Images/step2.png" width = 650/></p>
<p>Step 3. This step is for adding or deleting points.You can often skip it by pressing “a” on the keyboard. However, if you do want to add a point, you can click on the “Insert twilights” window to zoom in and then left click on the other window with the left mouse button to add a sunrise, and the right button to add a sunset some. You can use “u” on the keyboard to undo any changes, and “d” to delete any points which are extra. Press “a” to move to next step.</p>
<p>Step 4. This allows you to find points which have been miss-classified (often because the bird was in the shade or in a burrow) and to move the respective sunrise. Choose a point by clicking on it in the “edit twilights” window and the other window will displaz the sunrise (or sunsets) from the presvious and next days (purple and green) relative to the current sunrise or sunset. Thus if it is very much out, you can estimate the sunset on that day would likely have been sometime between that of the day before and after. You can then left click at the point where you want the day to start and press “a” to accept and move the sunrise or sunset. You will notice the red line then moves. Do this for as many points as necessary.</p>
<p>Then close the windows with “q”.</p>
<hr />
<p><span style="color:darkred"><strong>IMPORTANT</strong></span></p>
<p><span style="color:darkred">We want to save the output file so that we never have to do this step again. The output can be saved as a .csv file that can then easily be read into R at a later time.</span></p>
<p>The output contains the following importnatn information:</p>
<ul>
<li><span style="color:darkred"><strong>Twilight</strong></span></li>
<li>The date and time of the sunrise/sunset events</li>
<li><span style="color:darkred"><strong>Rise</strong></span></li>
<li>whether the Twilight is a sunrise (TRUE) or a sunset (FALSE)</li>
<li><span style="color:darkred"><strong>Deleted</strong></span></li>
<li>whether you marked this twilight with a “d”, that means it is still in the file and can/should be exlcuded later on.</li>
<li>Marker</li>
<li>see detailed description in <code>?preprocessLight</code></li>
<li>Inserted</li>
<li>whether this Twilight was manually inserted</li>
<li>Twilight3</li>
<li>the original Twilight. Only different to Twilight if you edited the timing</li>
</ul>
<p>Other processes like <code>twilightCalc</code> produce different outputs but it is preferred to get them into this format (at least with the columns <code>Twilight</code>and <code>Rise</code>), since you can go ahead with any analysis youj want using this twiligth file.</p>
<p>To save this file we use the metadata variables that were defined above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(twl, <span class="kw">paste0</span>(<span class="st">&quot;Data/Results/&quot;</span>, Species, <span class="st">&quot;/&quot;</span>, ID, <span class="st">&quot;_&quot;</span>, AnalCode, <span class="st">&quot;_twl.csv&quot;</span>), <span class="dt">row.names =</span> F)</code></pre></div>
<p>This can later be loaded using the following code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">twl &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">paste0</span>(<span class="st">&quot;Data/Results/&quot;</span>, Species, <span class="st">&quot;/&quot;</span>, ID, <span class="st">&quot;_&quot;</span>, AnalCode, <span class="st">&quot;_twl.csv&quot;</span>))
twl<span class="op">$</span>Twilight &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(twl<span class="op">$</span>Twilight, <span class="dt">tz =</span> <span class="st">&quot;GMT&quot;</span>) <span class="co"># get the Twilight times back into the POSIX. class format</span></code></pre></div>
<p>The result of this first part that is <strong>independent</strong>* of which package/analysis will be used next is the twiligth file that shoudl at least look like (can have more columns):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(twl[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</code></pre></div>
<pre><code>##              Twilight  Rise
## 1 2015-07-15 19:34:02 FALSE
## 2 2015-07-16 03:01:00  TRUE
## 3 2015-07-16 19:43:53 FALSE
## 4 2015-07-17 02:51:06  TRUE
## 5 2015-07-17 19:48:53 FALSE
## 6 2015-07-18 02:46:06  TRUE</code></pre>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="loadingData.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="GeoLight.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["Light-level geolocation analysis.pdf", "Light-level geolocation analysis.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
